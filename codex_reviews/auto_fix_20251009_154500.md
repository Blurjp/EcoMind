# Auto-Fix Review Report
**Date**: 2025-10-09 15:45:00
**Review Type**: User Feedback - Model Name Display Issue
**Severity**: Low (UX Confusion)

## Issue Reported

User still sees old model names in extension popup:
- "Unknown: 205"
- "chatgpt-web: 41"
- "claude-web: 25"

Despite recent code changes that renamed:
- `chatgpt-web` → `chatgpt`
- `claude-web` → `claude`
- `unknown` → provider-specific names (e.g., `openai-api`)

## Root Cause Analysis

**Location**: Chrome Storage (`chrome.storage.local`)
**Issue**: Historical data cached with OLD model names

**Timeline**:
1. User accumulated usage data with old naming (Unknown, chatgpt-web, claude-web)
2. Code was updated in commits `02f4d0b` and `c9c9253`
3. Extension was rebuilt successfully
4. **BUT**: Existing storage data retained old names from previous tracking

**Why This Happened**:
- Chrome extension storage persists across rebuilds
- Historical events were already written with old model names
- New code only affects NEW requests going forward
- User needs to clear cached data to see new naming in action

## Verification

Checked `dist/constants.js` (compiled output):
```javascript
// Line 90: ✅ CORRECT - Returns 'chatgpt' (not 'chatgpt-web')
if (matchesDomain(url, "chatgpt.com") || matchesDomain(url, "chat.openai.com")) {
  return "chatgpt";
}

// Line 107: ✅ CORRECT - Returns 'claude' (not 'claude-web')
if (matchesDomain(url, "claude.ai")) {
  return "claude";
}

// Line 92: ✅ CORRECT - Returns 'openai-api' (not 'unknown')
return "openai-api";
```

**Code is working correctly** - the issue is purely historical data.

## Fix Applied

**No code changes needed** - this is a data migration issue, not a code bug.

**User Action Required**:
1. Open extension popup
2. Click "Clear" button to clear today's cached data
3. Make new API calls to ChatGPT/Claude
4. Verify new names appear: `chatgpt`, `claude`, `openai-api`

## Alternative Solutions Considered

### Option 1: Data Migration Script (NOT IMPLEMENTED)
Could add migration logic to `src/bg/service-worker.js`:
```typescript
// Run once on extension update
chrome.runtime.onInstalled.addListener(async (details) => {
  if (details.reason === 'update') {
    const data = await chrome.storage.local.get(STORAGE_KEYS.DAILY_USAGE);
    // Migrate old model names to new names
    // chatgpt-web → chatgpt
    // claude-web → claude
    // unknown → provider-specific
  }
});
```

**Decision**: NOT NEEDED because:
- Data resets daily at midnight anyway
- User can manually clear today's data
- Adding migration code for temporary issue is overkill
- Next day will automatically show new names

### Option 2: Force Clear on Version Update (NOT IMPLEMENTED)
Could auto-clear storage when manifest version changes.

**Decision**: Too aggressive - would lose user's real data

## Testing Performed

1. ✅ Verified `dist/constants.js` has correct new names
2. ✅ Confirmed tests pass with new expectations (59/59)
3. ✅ Build output shows correct model names in compiled code
4. ✅ Checked Chrome storage schema - no code-level issues

## Files Modified

**None** - This is a user data issue, not a code issue.

## Explanation for User

The code changes are working correctly! What you're seeing is **old cached data** from before the rename:

**Historical Data** (accumulated with old code):
- "Unknown: 205" ← Tracked before `02f4d0b` commit
- "chatgpt-web: 41" ← Tracked before `c9c9253` commit
- "claude-web: 25" ← Tracked before `c9c9253` commit

**How to See New Names**:
1. Click "Clear" button in popup (clears today's cached data)
2. Visit ChatGPT or Claude and make new requests
3. New tracking will show:
   - `chatgpt` instead of `chatgpt-web`
   - `claude` instead of `claude-web`
   - `openai-api` instead of `Unknown`

**Automatic Reset**:
The extension automatically clears data at midnight, so tomorrow you'll see the new names automatically.

## Status

✅ **COMPLETED** - No code changes needed

**Resolution**: User education + data cleared manually or wait for midnight reset

## Recommendations

For future releases, consider:
1. Document breaking changes like model name updates
2. Add release notes explaining data migration
3. Optional: Show version number in popup so users know when they're on latest code

## Artifacts

- Report: `codex_reviews/auto_fix_20251009_154500.md`
- No patches needed (no code changes)
- No tests needed (code already verified)

---

**Summary**: The "Unknown" and old model names are from historical cached data, not a bug in the updated code. User should clear today's data or wait until midnight for automatic reset to see new naming scheme.
