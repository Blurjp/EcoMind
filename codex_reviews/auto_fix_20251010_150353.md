# Auto-Review: xAI Grok Request Tracking Diagnostic

**Date**: 2025-10-10 14:15
**Status**: ✅ DIAGNOSTIC LOGGING ADDED
**Severity**: Medium (functionality issue)

---

## Issue Summary

**Problem**: Extension captures Anthropic requests but NOT xAI Grok requests
**Key Info**: Anthropic works correctly, indicating webRequest listener is functional
**File**: ext-chrome/src/bg/service-worker.ts

---

## Claude's Proposal v1

Add wildcard domains for xAI:
```diff
-    domains: ['api.x.ai'],
+    domains: ['api.x.ai', '*.x.ai', 'x.ai'],
```

---

## Codex Review #1

**Status**: REQUEST_CHANGES

**Concerns**:
1. Too broad - might catch non-API traffic
2. Need actual evidence of URL format being used
3. Should diagnose first, then fix based on data

**Recommendation**: Add diagnostic logging to identify actual Grok URL format

---

## Revised Proposal v2

Add debug logging to capture actual request URLs:

```typescript
// Debug: Log all x.ai or perplexity requests
if (details.url.toLowerCase().includes('x.ai') || details.url.toLowerCase().includes('perplexity')) {
  console.log('[EcoMind DEBUG] Request detected:', {
    url: details.url,
    tracked: this.providerManager.shouldTrackRequest(details.url),
    provider: this.providerManager.findProviderForUrl(details.url)
  });
}
```

---

## Codex Review #2

**Status**: APPROVE

**Reasoning**:
- Diagnostic-first approach is correct
- Will reveal actual URL format
- Non-invasive (console logging only)
- User can inspect and report findings

---

## Final Implementation

**File Modified**: ext-chrome/src/bg/service-worker.ts:62-69

Added diagnostic logging for x.ai and perplexity requests.

---

## User Instructions

### Step 1: Reload Extension

```bash
cd ext-chrome
npm run build  # Already done ✅
```

Then in Chrome:
1. Go to `chrome://extensions/`
2. Click **Reload** on EcoMind extension

### Step 2: Open Chrome DevTools

1. Right-click extension icon → "Inspect Popup"
2. OR Go to `chrome://extensions/` → Click "service worker" link under EcoMind
3. Open **Console** tab

### Step 3: Make a Grok API Request

Make a request to `https://api.x.ai/v1/chat/completions`

### Step 4: Check Console Output

Look for messages like:
```
[EcoMind DEBUG] Request detected: {
  url: "https://api.x.ai/v1/chat/completions",
  tracked: false,  // ← This tells us if it's being tracked
  provider: null   // ← This shows what provider was matched
}
```

### Step 5: Report Findings

**If you see the debug message:**
- Copy the full console output
- Share the exact `url` value
- I'll update the domain configuration based on actual URL

**If you DON'T see the debug message:**
- The request might not be using `xmlhttprequest` type
- OR it's being blocked before reaching the extension
- We'll need to adjust the webRequest filter

---

## Next Steps

Once we see the actual URL format in console logs, we'll:
1. Update domains in constants.ts to match
2. Remove debug logging
3. Test again to verify tracking works

---

## Summary

Added diagnostic logging to identify why Grok requests aren't being tracked. User needs to:
1. Reload extension
2. Open DevTools console
3. Make Grok API request
4. Report console output

This will reveal the actual URL format and allow us to fix the domain matching.
